<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>pi</title>
<style>
  /* ── tldraw design tokens ── */
  :root {
    --bg: hsl(210, 20%, 98%);
    --panel: hsl(0, 0%, 99%);
    --panel-contrast: hsl(0, 0%, 100%);
    --low: hsl(204, 16%, 94%);
    --low-border: hsl(204, 16%, 92%);
    --divider: hsl(0, 0%, 91%);
    --muted-1: hsl(0, 0%, 0%, 10%);
    --muted-2: hsl(0, 0%, 0%, 4.3%);
    --hint: hsl(0, 0%, 0%, 5.5%);
    --overlay: hsl(0, 0%, 0%, 20%);
    --text-0: hsl(0, 0%, 11%);
    --text-1: hsl(0, 0%, 18%);
    --text-3: hsl(204, 4%, 45%);
    --primary: hsl(214, 84%, 56%);
    --danger: hsl(0, 90%, 43%);
    --success: hsl(123, 46%, 34%);
    --shadow-1: 0px 1px 2px hsl(0,0%,0%,25%), 0px 1px 3px hsl(0,0%,0%,9%);
    --shadow-2: 0px 0px 2px hsl(0,0%,0%,16%), 0px 2px 3px hsl(0,0%,0%,24%), 0px 2px 6px hsl(0,0%,0%,0.1), inset 0 0 0 1px var(--panel-contrast);
    --shadow-3: 0px 1px 2px hsl(0,0%,0%,28%), 0px 2px 6px hsl(0,0%,0%,14%), inset 0 0 0 1px var(--panel-contrast);
    --radius-1: 4px;
    --radius-2: 6px;
    --radius-3: 9px;
    --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    --font-mono: 'SF Mono', SFMono-Regular, ui-monospace, 'DejaVu Sans Mono', Menlo, Consolas, monospace;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; font-family: var(--font); font-size: 13px; color: var(--text-1); background: var(--bg); -webkit-font-smoothing: antialiased; }

  body { display: flex; flex-direction: column; }

  /* ── Status bar ── */
  .status-bar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 12px; height: 40px; flex-shrink: 0;
    background: var(--panel); border-bottom: 1px solid var(--divider);
  }
  .status-left, .status-right { display: flex; align-items: center; gap: 8px; }
  .status-label { font-size: 12px; font-weight: 500; color: var(--text-0); }
  .status-model { font-size: 11px; color: var(--text-3); }
  .status-streaming { font-size: 11px; color: var(--primary); display: none; align-items: center; gap: 4px; }
  .status-streaming.visible { display: flex; }
  .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--primary); animation: pulse 1.5s ease-in-out infinite; }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

  /* ── Buttons (tldraw-style) ── */
  .tl-btn {
    position: relative; display: inline-flex; align-items: center; justify-content: center;
    height: 32px; min-width: 32px; padding: 0 10px;
    border: none; background: none; cursor: pointer;
    font: inherit; font-size: 12px; font-weight: 500; color: var(--text-1);
    border-radius: var(--radius-2);
  }
  .tl-btn::after {
    content: ''; position: absolute; inset: 2px;
    border-radius: var(--radius-2); background: var(--muted-2); opacity: 0;
    transition: opacity 0.12s;
  }
  .tl-btn:hover::after { opacity: 1; }
  .tl-btn:active::after { background: var(--hint); opacity: 1; }
  .tl-btn:disabled { color: var(--text-3); cursor: default; }
  .tl-btn:disabled::after { display: none; }
  .tl-btn span { position: relative; z-index: 1; }

  .tl-btn-primary {
    background: var(--primary); color: white; border-radius: var(--radius-3);
  }
  .tl-btn-primary::after { display: none; }
  .tl-btn-primary:hover { filter: brightness(1.08); }
  .tl-btn-primary:disabled { opacity: 0.4; filter: none; }

  .tl-btn-danger {
    color: var(--danger);
  }

  /* ── Login ── */
  .login-overlay {
    display: none; flex: 1; align-items: center; justify-content: center;
  }
  .login-overlay.visible { display: flex; }
  .login-card {
    width: 320px; padding: 32px 28px; text-align: center;
    background: var(--panel); border-radius: 12px;
    box-shadow: var(--shadow-3);
  }
  .login-card h2 { font-size: 14px; font-weight: 600; color: var(--text-0); margin-bottom: 4px; }
  .login-card p { font-size: 11px; color: var(--text-3); margin-bottom: 16px; line-height: 1.5; }
  .login-card .tl-btn-primary { width: 100%; height: 36px; font-size: 12px; margin-bottom: 12px; }
  .login-input {
    width: 100%; height: 36px; padding: 0 12px;
    border: 1px solid var(--low-border); border-radius: var(--radius-2);
    font: inherit; font-size: 12px; color: var(--text-1); background: var(--panel-contrast);
    outline: none; transition: border-color 0.12s;
  }
  .login-input:focus { border-color: var(--primary); }
  .login-input::placeholder { color: var(--text-3); }
  .login-code { display: none; }
  .login-code.visible { display: flex; flex-direction: column; gap: 8px; }
  .login-error { font-size: 11px; color: var(--danger); display: none; margin-top: 8px; }
  .login-error.visible { display: block; }
  .login-spinner { font-size: 11px; color: var(--text-3); display: none; margin-top: 8px; }
  .login-spinner.visible { display: block; }

  /* ── Messages area ── */
  .messages {
    flex: 1; overflow-y: auto; padding: 24px 0;
    scroll-behavior: smooth;
  }
  .messages-inner {
    max-width: 640px; margin: 0 auto; padding: 0 20px;
    display: flex; flex-direction: column; gap: 16px;
  }

  /* ── User message ── */
  .msg-user {
    display: flex; justify-content: flex-end;
  }
  .msg-user-bubble {
    max-width: 85%; padding: 8px 12px;
    background: var(--primary); color: white;
    border-radius: 14px 14px 4px 14px;
    font-size: 13px; line-height: 1.5; white-space: pre-wrap;
  }

  /* ── Assistant message ── */
  .msg-assistant {
    display: flex; justify-content: flex-start;
  }
  .msg-assistant-bubble {
    max-width: 90%; font-size: 13px; line-height: 1.6;
    color: var(--text-0);
  }

  /* ── Prose (markdown) ── */
  .prose p { margin: 6px 0; }
  .prose p:first-child { margin-top: 0; }
  .prose p:last-child { margin-bottom: 0; }
  .prose strong { font-weight: 600; }
  .prose em { font-style: italic; }
  .prose h1, .prose h2, .prose h3, .prose h4 { font-weight: 600; margin: 12px 0 4px; color: var(--text-0); }
  .prose h1 { font-size: 16px; }
  .prose h2 { font-size: 14px; }
  .prose h3 { font-size: 13px; }
  .prose h4 { font-size: 12px; }
  .prose ul, .prose ol { margin: 4px 0; padding-left: 20px; }
  .prose li { margin: 2px 0; }
  .prose blockquote { border-left: 2px solid var(--low-border); padding-left: 12px; color: var(--text-3); margin: 6px 0; }
  .prose pre {
    background: hsl(220, 13%, 18%); color: hsl(220, 14%, 80%);
    border-radius: var(--radius-2); padding: 10px 12px;
    margin: 6px 0; overflow-x: auto; font-size: 12px;
    font-family: var(--font-mono); line-height: 1.5;
  }
  .prose code:not(pre code) {
    background: var(--low); padding: 1px 5px;
    border-radius: var(--radius-1); font-size: 12px;
    font-family: var(--font-mono);
  }
  .prose a { color: var(--primary); text-decoration: none; }
  .prose a:hover { text-decoration: underline; }
  .prose table { border-collapse: collapse; margin: 6px 0; font-size: 12px; }
  .prose th, .prose td { border: 1px solid var(--divider); padding: 4px 8px; }
  .prose th { background: var(--low); font-weight: 500; }

  /* ── Tool call ── */
  .tool-block {
    border-radius: var(--radius-2);
    background: var(--panel);
    box-shadow: var(--shadow-1);
    overflow: hidden; font-size: 11px;
    margin: 4px 0;
  }
  .tool-block summary {
    padding: 5px 10px; cursor: pointer; user-select: none;
    color: var(--text-3); font-weight: 500;
    list-style: none; display: flex; align-items: center; gap: 5px;
  }
  .tool-block summary::-webkit-details-marker { display: none; }
  .tool-block summary::before {
    content: ''; width: 0; height: 0;
    border-left: 4px solid var(--text-3); border-top: 3px solid transparent; border-bottom: 3px solid transparent;
    transition: transform 0.12s;
  }
  .tool-block[open] summary::before { transform: rotate(90deg); }
  .tool-details {
    padding: 8px 10px; border-top: 1px solid var(--divider);
    max-height: 240px; overflow-y: auto;
    font-family: var(--font-mono); font-size: 11px; color: var(--text-3);
    line-height: 1.5;
  }
  .tool-details pre { margin: 0; white-space: pre-wrap; word-break: break-word; }
  .tool-result-ok { color: var(--success); }
  .tool-result-err { color: var(--danger); }

  /* ── Thinking block ── */
  .thinking-block {
    border-radius: var(--radius-2);
    border: 1px solid var(--low-border);
    overflow: hidden; font-size: 11px; margin: 4px 0;
  }
  .thinking-block summary {
    padding: 4px 10px; cursor: pointer; user-select: none;
    color: var(--text-3); font-style: italic;
    list-style: none;
  }
  .thinking-block summary::-webkit-details-marker { display: none; }
  .thinking-body {
    padding: 6px 10px; border-top: 1px solid var(--low-border);
    max-height: 160px; overflow-y: auto;
    color: var(--text-3); white-space: pre-wrap; line-height: 1.5;
  }

  /* ── Input bar ── */
  .input-bar {
    flex-shrink: 0; padding: 12px 20px 16px;
    display: flex; justify-content: center;
  }
  .input-inner {
    display: flex; align-items: flex-end; gap: 6px;
    max-width: 640px; width: 100%;
    background: var(--panel); border-radius: 16px;
    box-shadow: var(--shadow-2);
    padding: 6px 6px 6px 16px;
  }
  .input-inner textarea {
    flex: 1; border: none; outline: none; resize: none;
    font: inherit; font-size: 13px; color: var(--text-1);
    background: none; line-height: 1.5; padding: 6px 0;
    max-height: 160px;
  }
  .input-inner textarea::placeholder { color: var(--text-3); }
  .input-send {
    width: 32px; height: 32px; border-radius: 50%;
    background: var(--primary); border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; transition: opacity 0.12s;
  }
  .input-send:disabled { opacity: 0.3; cursor: default; }
  .input-send svg { width: 16px; height: 16px; fill: none; stroke: white; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
</style>
</head>
<body>

<!-- Status bar -->
<header class="status-bar">
  <div class="status-left">
    <span class="status-label">pi</span>
    <span id="modelLabel" class="status-model">connecting...</span>
  </div>
  <div class="status-right">
    <span id="streamIndicator" class="status-streaming">
      <span class="status-dot"></span>
      <span>working</span>
    </span>
    <button id="abortBtn" class="tl-btn tl-btn-danger" style="display:none"><span>Stop</span></button>
    <button id="newSessionBtn" class="tl-btn"><span>New</span></button>
  </div>
</header>

<!-- Login overlay -->
<div id="loginOverlay" class="login-overlay">
  <div class="login-card">
    <h2>Sign in to Anthropic</h2>
    <p>Claude Pro or Max account required.<br>Opens claude.ai for authentication.</p>
    <button id="loginBtn" class="tl-btn tl-btn-primary"><span>Continue with Anthropic</span></button>
    <div id="loginCodeSection" class="login-code">
      <input id="loginCodeInput" class="login-input" type="text" placeholder="Paste authorization code" />
      <button id="loginSubmitBtn" class="tl-btn tl-btn-primary"><span>Verify</span></button>
    </div>
    <p id="loginError" class="login-error"></p>
    <p id="loginSpinner" class="login-spinner">Authenticating...</p>
  </div>
</div>

<!-- Messages -->
<main id="messages" class="messages">
  <div id="messagesInner" class="messages-inner"></div>
</main>

<!-- Input -->
<footer class="input-bar">
  <form id="inputForm" class="input-inner">
    <textarea id="userInput" rows="1" placeholder="Message pi..."></textarea>
    <button type="submit" id="sendBtn" class="input-send" disabled>
      <svg viewBox="0 0 24 24"><path d="M22 2 11 13"/><path d="M22 2 15 22 11 13 2 9z"/></svg>
    </button>
  </form>
</footer>

<script src="pi-chat.js"></script>
</body>
</html>
